---
phase: 09-distribution-quality
plan: 02
type: execute
wave: 1
depends_on: [09-01]
files_modified:
  - INSTALL.md
  - TROUBLESHOOTING.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "User reads INSTALL.md and successfully installs app on clean macOS machine"
    - "User encounters Gatekeeper warning and follows documented workaround"
    - "User finds solution in TROUBLESHOOTING.md for Neo4j connection issues"
    - "User finds solution in TROUBLESHOOTING.md for missing dependencies"
    - "README.md provides clear quick start guide with screenshots section (placeholders acceptable; actual screenshots captured after clean machine test)"
  artifacts:
    - path: "INSTALL.md"
      provides: "Step-by-step installation guide"
      min_lines: 80
    - path: "TROUBLESHOOTING.md"
      provides: "Common issues and solutions"
      min_lines: 100
    - path: "README.md"
      provides: "Updated project overview for native Mac app"
      contains: "Quick Start section with screenshots"
  key_links:
    - from: "INSTALL.md"
      to: "CHANGELOG.md"
      via: "Version reference (v1.2.0)"
    - from: "TROUBLESHOOTING.md"
      to: "apps/native_mac/setup.py"
      via: "Dependency troubleshooting guidance"
    - from: "README.md"
      to: "INSTALL.md"
      via: "Installation quick link"
---

<objective>
Create comprehensive documentation for installation, troubleshooting, and project overview.

Purpose: Enable users to self-service install the app and resolve common issues without developer support. Screenshots in README provide visual confirmation of app appearance and workflow.

Output: INSTALL.md (installation guide), TROUBLESHOOTING.md (common issues), and updated README.md with quick start and screenshots.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-distribution-quality/09-CONTEXT.md
@.planning/phases/09-distribution-quality/09-RESEARCH.md
@apps/native_mac/setup.py
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create INSTALL.md with step-by-step installation guide</name>
  <files>INSTALL.md</files>
  <action>
Create INSTALL.md with the following structure:

# Installation Guide - NASCAR DFS Optimizer v1.2.0

## Requirements

- macOS 12.0 (Monterey) or later
- Apple Silicon (M1/M2/M3) or Intel Mac
- 4GB RAM minimum, 8GB recommended
- 500MB free disk space for app bundle
- Neo4j 5.x or 4.x database server (for constraint ontology)

## Installation

### Step 1: Download the App

1. Visit the [GitHub Releases](https://github.com/your-repo/releases) page
2. Download the latest version: `NASCAR-DFS-Optimizer-1.2.0.zip`
3. Extract the zip file to get `NASCAR DFS Optimizer.app`

### Step 2: Install the App

1. Drag `NASCAR DFS Optimizer.app` to your `/Applications` folder
2. Launch the app by double-clicking in `/Applications`

### Step 3: Gatekeeper (First Launch Only)

On first launch, macOS may show a security warning:
> "NASCAR DFS Optimizer.app is damaged and can't be opened"

**Solution:**
1. Right-click (Control-click) on the app
2. Select "Open" from the context menu
3. Click "Open" in the confirmation dialog

You only need to do this once. The app will launch normally afterward.

## Neo4j Setup

The app requires Neo4j database for constraint ontology.

### Option A: Docker (Recommended)

```bash
docker run -d \
  --name neo4j \
  -p 7474:7474 -p 7687:7687 \
  -e NEO4J_AUTH=neo4j/yourpassword \
  neo4j:5.15
```

### Option B: Native Installation

Download Neo4j from [neo4j.com](https://neo4j.com/download/) and follow the macOS installation guide.

### Configure the App

1. Launch NASCAR DFS Optimizer
2. Go to Settings → Neo4j Connection
3. Enter connection details:
   - URI: `bolt://localhost:7687`
   - Username: `neo4j`
   - Password: (your password from Docker or setup)

## Verification

After installation, verify the app works:

1. Launch the app
2. Go to File → Open and import a sample CSV file
3. Set constraints and click "Run Optimization"
4. Verify lineups are generated in the Lineups tab

## Uninstalling

To remove the app:
1. Quit NASCAR DFS Optimizer
2. Delete `NASCAR DFS Optimizer.app` from `/Applications`
3. (Optional) Delete `~/Library/Application Support/com.zax.nascar-dfs` to remove app data

## Next Steps

See README.md for a quick start guide and TROUBLESHOOTING.md for common issues.
</action>
  <verify>
grep -q "Gatekeeper" INSTALL.md && grep -q "Neo4j" INSTALL.md && grep -q "Docker" INSTALL.md
</verify>
  <done>
INSTALL.md provides complete installation guide with Neo4j setup, Gatekeeper workaround, and verification steps
</done>
</task>

<task type="auto">
  <name>Task 2: Create TROUBLESHOOTING.md with common issues and solutions</name>
  <files>TROUBLESHOOTING.md</files>
  <action>
Create TROUBLESHOOTING.md with the following structure:

# Troubleshooting Guide - NASCAR DFS Optimizer v1.2.0

Common issues and solutions for the macOS app.

## Installation Issues

### "App is damaged and can't be opened"

**Cause:** macOS Gatekeeper blocks unsigned or ad-hoc signed apps.

**Solution:**
1. Right-click (Control-click) the app
2. Select "Open"
3. Click "Open" in the dialog
4. This is only required on first launch

**Alternative:** Temporarily disable Gatekeeper (not recommended):
```bash
sudo spctl --master-disable
# Launch the app
sudo spctl --master-enable
```

### "Bad CPU type in executable" Error

**Cause:** Architecture mismatch (app built for wrong CPU type).

**Solution:** Download the correct build:
- Apple Silicon (M1/M2/M3): Use universal2 build (included)
- Intel Mac: Use universal2 build (included)

If issue persists, rebuild from source on your machine.

### App crashes on launch

**Cause:** Missing dependencies or incompatible macOS version.

**Solution:**
1. Verify macOS version: 12.0 (Monterey) or later required
2. Check Console.app for crash logs: Applications → Utilities → Console
3. Look for "ImportError" or "ModuleNotFoundError" in logs
4. Report issues with crash logs on GitHub

## Neo4j Connection Issues

### "Connection refused" when connecting to Neo4j

**Cause:** Neo4j server not running or wrong port.

**Solution:**
1. Verify Neo4j is running:
   ```bash
   docker ps | grep neo4j
   # or check Neo4j Desktop app
   ```
2. Check port 7687 is accessible:
   ```bash
   lsof -i :7687
   ```
3. If using Docker, restart the container:
   ```bash
   docker restart neo4j
   ```

### "Authentication failed" when connecting to Neo4j

**Cause:** Incorrect username or password.

**Solution:**
1. Verify credentials in Settings → Neo4j Connection
2. Default Neo4j credentials: `neo4j` / `neo4j` (first login requires password change)
3. If using Docker, check the `-e NEO4J_AUTH` variable

### Neo4j constraint ontology not loading

**Cause:** Database schema not initialized or incompatible Neo4j version.

**Solution:**
1. Verify Neo4j version: 4.x or 5.x required
2. Open Neo4j Browser at http://localhost:7474
3. Run schema verification:
   ```cypher
   CALL db.schema() YIELD nodes, relationships
   RETURN nodes, relationships
   ```
4. If no schema exists, the app will auto-create it on first run

## App Performance Issues

### Optimization is slow (30+ seconds)

**Cause:** Running optimization on local CPU (normal for MCMC sampling).

**Solution:**
1. Use GPU offload for faster optimization:
   - Settings → GPU Offload
   - Enter Windows GPU worker URL
   - Test connection
2. Reduce iterations in Optimization tab (default 1000, try 500)
3. Reduce lineup count (default 10, try 5)

### App freezes during optimization

**Cause:** Long-running MCMC job blocking UI thread.

**Solution:**
1. Optimization runs in background thread by design
2. If UI freezes, wait for job to complete (monitor in Jobs tab)
3. Force-quit app if frozen for >2 minutes and try again with fewer iterations

## Data Import/Export Issues

### CSV import fails with parsing errors

**Cause:** Malformed CSV or incorrect column headers.

**Solution:**
1. Verify CSV format matches expected schema:
   - Required columns: Driver, Salary, Team, Position
   - Encoding: UTF-8 or UTF-8 with BOM
2. Open CSV in text editor to check for special characters
3. Use Excel "Save as CSV UTF-8" if export from Excel

### Lineup export fails with "invalid format"

**Cause:** Lineup data contains invalid characters or missing fields.

**Solution:**
1. Verify lineups have 6 drivers each
2. Check total salary <= $50,000
3. Export to JSON for debugging, inspect for invalid data

## GUI Issues

### Dark mode not working correctly

**Cause:** App not following system appearance or macOS version < 10.14.

**Solution:**
1. Verify macOS version: 10.14 (Mojave) or later required
2. App should auto-detect system dark mode
3. If still broken, restart app after changing system appearance

### Keyboard shortcuts not working

**Cause:** Shortcut conflicts or custom shortcuts disabled.

**Solution:**
1. Check Settings → Keyboard Shortcuts for custom bindings
2. Verify no app conflicts (check macOS System Settings → Keyboard → Shortcuts)
3. Reset to factory defaults in Settings → Keyboard Shortcuts → Reset

### Window geometry not saving

**Cause:** App data directory permissions or corrupted state.

**Solution:**
1. Reset app data (WARNING: clears all settings):
   ```bash
   rm -rf ~/Library/Application Support/com.zax.nascar-dfs
   ```
2. Relaunch app

## Still Having Issues?

1. Check Console.app for error logs (filter by "NASCAR DFS Optimizer")
2. Search [GitHub Issues](https://github.com/your-repo/issues) for similar problems
3. Create a new issue with:
   - macOS version
   - App version
   - Steps to reproduce
   - Console logs (if applicable)
</action>
  <verify>
grep -q "Gatekeeper" TROUBLESHOOTING.md && grep -q "Neo4j" TROUBLESHOOTING.md && grep -q "Console.app" TROUBLESHOOTING.md
</verify>
  <done>
TROUBLESHOOTING.md covers Gatekeeper, Neo4j connection, performance, data import/export, and GUI issues with actionable solutions
</done>
</task>

<task type="auto">
  <name>Task 3: Update README.md for native Mac app with quick start and screenshots</name>
  <files>README.md</files>
  <action>
Update README.md to reflect native Mac app distribution (replacing old FastAPI/Next.js architecture):

1. Replace overview section with:
# NASCAR DFS Optimizer v1.2.0

Native macOS desktop application for DraftKings NASCAR DFS optimization using physics-compliant constraints and MCMC sampling.

## Features

- **Native macOS GUI** with PySide6/Qt6
- **Tabbed Interface**: Race Data, Optimization, Lineups, Jobs, Settings
- **CSV Import/Export** for race data and DraftKings lineup uploads
- **Local Optimization** with JAX-based MCMC engine (Apple Silicon optimized)
- **Constraint Presets** for saving/loading optimization configurations
- **Undo/Redo** system with CMD+Z / CMD+Shift+Z
- **Keyboard Shortcuts** with full customization
- **Split-View Editor** for real-time optimization preview
- **Background Jobs** with dock badge and menubar status
- **GPU Offload** (optional Windows GPU for heavy jobs)
- **Settings Backup** to JSON for data portability

2. Add Quick Start section:

## Quick Start

1. Download `NASCAR-DFS-Optimizer-1.2.0.zip` from [GitHub Releases](https://github.com/your-repo/releases)
2. Extract and drag `NASCAR DFS Optimizer.app` to `/Applications`
3. Launch the app (Control-click → Open on first launch for Gatekeeper)
4. Import race data: File → Open (select CSV with driver data)
5. Set constraints and click "Run Optimization"
6. Export lineups: Lineups tab → Export to DraftKings

3. Add Installation section:

## Installation

See [INSTALL.md](INSTALL.md) for detailed installation guide, Neo4j setup, and Gatekeeper workaround.

  4. Add Screenshots section (placeholder with instructions):

## Screenshots

### Main Window
[TODO: Capture screenshot of main window showing all tabs]

### Optimization Tab
[TODO: Capture screenshot of Optimization tab with constraints panel]

### Lineups Tab
[TODO: Capture screenshot of Lineups tab with generated lineups]

**Note:** Screenshot placeholders will be replaced with actual screenshots during Plan 03 clean machine testing. Use Cmd+Shift+4 to capture screenshots after verifying app functionality on clean macOS machine.

5. Add Documentation section:

## Documentation

- [INSTALL.md](INSTALL.md) - Installation guide with Neo4j setup
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Common issues and solutions
- [CHANGELOG.md](CHANGELOG.md) - Version history and release notes

6. Add Requirements section:

## Requirements

- macOS 12.0 (Monterey) or later
- Apple Silicon (M1/M2/M3) or Intel Mac
- 4GB RAM minimum, 8GB recommended
- Neo4j 5.x or 4.x (for constraint ontology)

7. Remove outdated sections (FastAPI, Next.js, architecture diagrams from old web version)

Keep the concise overview; old architecture is no longer relevant for native Mac app.
</action>
  <verify>
grep -q "Native macOS GUI" README.md && grep -q "Quick Start" README.md && grep -q "INSTALL.md" README.md
</verify>
  <done>
README.md updated with native Mac app overview, quick start guide, screenshots section, and links to INSTALL.md and TROUBLESHOOTING.md
</done>
</task>

</tasks>

<verification>
After all tasks complete:
- INSTALL.md provides complete installation guide
- TROUBLESHOOTING.md covers common issues with solutions
- README.md updated for native Mac app with quick start and screenshots placeholders
- All documentation links work correctly
</verification>

<success_criteria>
User can read documentation and successfully install and use the app without developer support
</success_criteria>

<output>
After completion, create `.planning/phases/09-distribution-quality/09-02-SUMMARY.md`
</output>
