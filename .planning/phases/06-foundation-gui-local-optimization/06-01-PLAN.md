---
phase: 06-foundation-gui-local-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/native_mac/setup.py
  - apps/native_mac/pyproject.toml
  - apps/native_mac/main.py
autonomous: true

must_haves:
  truths:
    - "Developer can run 'python -m apps.native_mac.main' to launch the Qt application"
    - "Application window opens with title 'NASCAR DFS Optimizer' and standard macOS menu bar"
    - "Application has File, Edit, View, Window, and Help menus"
    - "CMD+Q quits the application properly"
    - "Application follows system dark mode appearance"
  artifacts:
    - path: "apps/native_mac/main.py"
      provides: "QApplication entry point with QMainWindow setup"
      min_lines: 50
    - path: "apps/native_mac/setup.py"
      provides: "py2app build configuration"
      contains: "py2app"
    - path: "apps/native_mac/pyproject.toml"
      provides: "Project metadata and dependencies"
      contains: "PySide6"
  key_links:
    - from: "apps/native_mac/main.py"
      to: "PySide6.QtWidgets.QApplication"
      via: "from PySide6.QtWidgets import QApplication"
      pattern: "from PySide6.QtWidgets.*QApplication"
    - from: "apps/native_mac/setup.py"
      to: "py2app build script"
      via: "setup.py configuration"
      pattern: "options.*py2app"
---

## Objective

Create the foundational PySide6 application structure with main window, standard macOS menus, and py2app bundling configuration. This establishes the native macOS application skeleton that all subsequent GUI features will build upon.

**Purpose:** Native macOS apps require proper Qt application lifecycle, menu bar integration, and app bundle structure. Without this foundation, GUI components lack proper macOS integration (menus, keyboard shortcuts, window management).

**Output:** Working PySide6 application that launches with standard macOS menus and can be bundled as a .app.

## Context

@/Users/zax/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zax/.claude/get-shit-done/templates/summary.md

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-foundation-gui-local-optimization/06-RESEARCH.md

# Existing backend to reference
@apps/backend/app/optimizer.py
@apps/backend/app/portfolio_generator.py
@apps/backend/app/models.py

## Tasks

<task type="auto">
  <name>Create project structure and dependency configuration</name>
  <files>apps/native_mac/pyproject.toml, apps/native_mac/setup.py</files>
  <action>
Create the native Mac app directory structure with dependency management:

1. Create `apps/native_mac/` directory with:
   - `__init__.py` (empty package marker)
   - `pyproject.toml` with project metadata and dependencies
   - `setup.py` for py2app bundling

2. In `pyproject.toml`, define:
   - Project name: "nascar-dfs-optimizer"
   - Dependencies: PySide6 (>=6.9.0), pandas, jax[cpu]
   - Requires Python >=3.10

3. In `setup.py`, configure py2app:
   - app entry point: main.py
   - Includes: PySide6.QtCore, PySide6.QtWidgets, PySide6.QtGui
   - Info.plist with CFBundleName, CFBundleIdentifier
   - NSHighResolutionCapable: True

DO NOT install packages yet - just create configuration files.
  </action>
  <verify>
Files exist at `apps/native_mac/pyproject.toml` and `apps/native_mac/setup.py`
pyproject.toml contains PySide6 dependency
setup.py contains py2app configuration with app=["main.py"]
  </verify>
  <done>
Project structure created with PySide6 and py2app configured
Dependencies specified but not yet installed
  </done>
</task>

<task type="auto">
  <name>Create Qt application entry point with main window</name>
  <files>apps/native_mac/main.py</files>
  <action>
Create the main application entry point following Qt conventions:

1. Create `apps/native_mac/main.py` with:
   - QApplication creation and lifecycle management
   - MainWindow class inheriting from QMainWindow
   - Standard macOS menu bar (File, Edit, View, Window, Help)
   - CMD+Q keyboard shortcut for quit (QKeySequence.Quit)
   - CMD+, for preferences (placeholder)
   - Dark mode support using QPalette

2. MainWindow must include:
   - Window title: "NASCAR DFS Optimizer"
   - Initial size: 1200x800
   - Central widget placeholder (QLabel with "Welcome")
   - create_actions() method for QAction objects
   - create_menus() method for menu bar setup
   - Status bar for user feedback

3. Dark mode support:
   - Detect system appearance using QPalette
   - Apply system colors, not hardcoded values
   - Test: app should respect macOS dark mode setting

Follow research pattern from 06-RESEARCH.md > QMainWindow with Menu Bar and Actions.
  </action>
  <verify>
Run `python -m apps.native_mac.main` launches Qt application window
Window has title "NASCAR DFS Optimizer"
Menu bar shows File, Edit, View, Window, Help menus
CMD+Q quits application cleanly
App follows system dark mode appearance (toggle in System Settings to verify)
  </verify>
  <done>
Qt application launches and displays main window with standard macOS menus
Keyboard shortcuts work (CMD+Q quits)
Dark mode follows system appearance
  </done>
</task>

<task type="auto">
  <name>Install dependencies and verify Qt integration</name>
  <files>apps/native_mac/</files>
  <action>
Install PySide6 and verify Qt framework integration:

1. Install PySide6:
```bash
pip install PySide6
```

2. Verify installation by running main.py:
```bash
python -m apps.native_mac.main
```

3. Check for Qt platform integration:
   - Application should use cocoa platform plugin (macOS native)
   - Window should have standard macOS title bar
   - Menu bar should be at top of screen (not in window)

4. Test py2app alias mode (development build):
```bash
cd apps/native_mac
python setup.py py2app -A
```
This creates `build/` directory with alias .app for testing.

DO NOT create distributable .app bundle yet - that's Phase 9.
  </action>
  <verify>
`pip list | grep PySide6` shows PySide6 installed (version 6.9+)
`python -m apps.native_mac.main` launches without errors
Window uses native macOS title bar (not Qt default)
Menu bar is at top of screen (macOS convention)
`python setup.py py2app -A` creates build/ directory
`build/NASCAR DFS Optimizer.app/Contents/MacOS/main` launches the app
  </verify>
  <done>
PySide6 installed and working
Application launches as native macOS window
py2app alias build successful
  </done>
</task>

## Verification

After completing all tasks, verify the phase foundation:

1. Run `python -m apps.native_mac.main` - application window opens
2. Verify menu bar has File, Edit, View, Window, Help menus
3. Test CMD+Q - application quits cleanly
4. Toggle macOS dark mode - app appearance updates
5. Run `python setup.py py2app -A` - alias build created successfully
6. Launch alias .app from build/ directory - app works

## Success Criteria

- [ ] PySide6 application launches from command line
- [ ] Main window displays with correct title and size
- [ ] Standard macOS menus present and functional
- [ ] CMD+Q keyboard shortcut works
- [ ] Dark mode follows system appearance
- [ ] py2app alias build created and functional

## Output

After completion, create `.planning/phases/06-foundation-gui-local-optimization/06-01-SUMMARY.md`
