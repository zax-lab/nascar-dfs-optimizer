---
phase: 06-foundation-gui-local-optimization
plan: 04
type: execute
wave: 2
depends_on: ["06-01", "06-03"]
files_modified:
  - apps/native_mac/gui/main_window.py
  - apps/native_mac/main.py
autonomous: true

must_haves:
  truths:
    - "MainWindow displays tabbed interface with tabs: Race Data, Optimization, Lineups, Settings"
    - "Race Data tab shows driver table view with DriverTableModel"
    - "Each tab displays a placeholder QLabel with tab name"
    - "Tab changes are reflected in window title"
    - "Window geometry is saved on close and restored on launch"
  artifacts:
    - path: "apps/native_mac/gui/main_window.py"
      provides: "QMainWindow with tabbed interface"
      min_lines: 100
    - path: "apps/native_mac/main.py"
      provides: "Updated entry point using MainWindow from gui/"
      contains: "from apps.native_mac.gui.main_window import MainWindow"
  key_links:
    - from: "apps/native_mac/gui/main_window.py"
      to: "apps/native_mac/gui/models/driver_model.py"
      via: "DriverTableModel import"
      pattern: "from.*models.driver_model import DriverTableModel"
    - from: "apps/native_mac/gui/main_window.py"
      to: "PySide6.QtWidgets.QTabWidget"
      via: "QTabWidget for tabbed interface"
      pattern: "QTabWidget"
    - from: "apps/native_mac/gui/main_window.py"
      to: "apps/native_mac/persistence/session_manager.py"
      via: "SessionManager for state persistence"
      pattern: "from.*persistence.session_manager import SessionManager"
---

## Objective

Refactor MainWindow to use proper tabbed interface structure and integrate Qt models from the gui/ package. This establishes the main UI structure that all subsequent features will build upon.

**Purpose:** Phase 1 created a basic main.py with inline MainWindow. Now we need proper package structure, tabbed interface for different features, and integration with the Qt models we just created. This is the foundation for all UI work.

**Output:** MainWindow with tabbed interface (Race Data, Optimization, Lineups, Settings), proper package structure, and session persistence integration.

## Context

@/Users/zax/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zax/.claude/get-shit-done/templates/summary.md

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-foundation-gui-local-optimization/06-RESEARCH.md
@.planning/phases/06-foundation-gui-local-optimization/06-01-SUMMARY.md
@.planning/phases/06-foundation-gui-local-optimization/06-03-SUMMARY.md

## Tasks

<task type="auto">
  <name>Create MainWindow class with tabbed interface</name>
  <files>apps/native_mac/gui/main_window.py</files>
  <action>
Create proper MainWindow class with tabbed interface in gui package:

1. Create `apps/native_mac/gui/` directory with `__init__.py`

2. Create `main_window.py` with MainWindow class:
   - Move and refactor MainWindow from main.py into gui package
   - Add QTabWidget as central widget
   - Create 4 tabs: "Race Data", "Optimization", "Lineups", "Settings"
   - Each tab has placeholder content (QLabel with tab name)
   - Integrate SessionManager for geometry persistence

3. Implement tab structure:
   - create_race_data_tab() -> returns QWidget with driver table
   - create_optimization_tab() -> returns QWidget (placeholder)
   - create_lineups_tab() -> returns QWidget (placeholder)
   - create_settings_tab() -> returns QWidget (placeholder)

4. Implement session persistence:
   - Accept SessionManager in constructor
   - Call load_window_geometry() on initialization
   - Override closeEvent to save_window_geometry()

5. Add currentChanged signal handler for QTabWidget:
   - Update window title to show current tab
   - Example: "NASCAR DFS Optimizer - Race Data"

Follow research pattern from 06-RESEARCH.md > QMainWindow with Tabbed Interface.
  </action>
  <verify>
main_window.py exists with MainWindow class
MainWindow has QTabWidget as central widget
4 tabs created: Race Data, Optimization, Lineups, Settings
create_*_tab() methods exist
SessionManager integration in constructor and closeEvent
Tab changes update window title
  </verify>
  <done>
MainWindow refactored into gui package
Tabbed interface with 4 tabs working
Session persistence integrated
Window geometry saves and restores properly
  </done>
</task>

<task type="auto">
  <name>Integrate DriverTableModel into Race Data tab</name>
  <files>apps/native_mac/gui/main_window.py</files>
  <action>
Enhance Race Data tab with driver table view using DriverTableModel:

1. Update create_race_data_tab() method:
   - Create QTableView for driver display
   - Instantiate DriverTableModel with sample driver data
   - Set model on table view
   - Enable sorting via table.setSortingEnabled(True)
   - Configure column sizing (stretch to fit, minimum widths)
   - Add table to tab layout

2. Create sample driver data for testing:
```python
sample_drivers = [
    {"name": "Driver One", "salary": 10500, "projected_points": 45.2, "ownership": 12.5, "team": "Team A"},
    # ... more sample drivers
]
```

3. Configure QTableView:
   - setAlternatingRowColors(True) for readability
   - setSelectionBehavior(QAbstractItemView.SelectRows)
   - setSelectionMode(QAbstractItemView.SingleSelection)
   - Hide vertical header (row numbers)

This is placeholder data - real data import comes in plan 06-05.
  </action>
  <verify>
Race Data tab contains QTableView
DriverTableModel set as table model
Sample drivers visible in table
Sorting enabled (click column headers to sort)
Alternating row colors enabled
Column sizing configured properly
  </verify>
  <done>
Driver table view integrated and functional
Sample driver data displayed
Table sorting working
UI looks professional with alternating row colors
  </done>
</task>

<task type="auto">
  <name>Update main.py entry point to use gui package</name>
  <files>apps/native_mac/main.py</files>
  <action>
Refactor main.py to use MainWindow from gui package:

1. Remove MainWindow class from main.py (moved to gui/main_window.py)

2. Update imports:
```python
from apps.native_mac.gui.main_window import MainWindow
from apps.native_mac.persistence.session_manager import SessionManager
```

3. Update application startup:
   - Create SessionManager instance
   - Pass SessionManager to MainWindow constructor
   - Restore window geometry via SessionManager
   - Show window

4. Keep menu creation and dark mode support in main.py (app-level concerns)

5. Ensure clean imports and no circular dependencies

main.py should now be ~50 lines (down from ~150+ with inline MainWindow).
  </action>
  <verify>
main.py imports MainWindow from gui.main_window
main.py imports SessionManager from persistence.session_manager
SessionManager passed to MainWindow constructor
Application launches and displays tabbed interface
Window geometry restores on launch
  </verify>
  <done>
main.py refactored to use gui package structure
Clean separation between app-level and window-level code
Application launches with proper package structure
  </done>
</task>

## Verification

After completing all tasks, verify the MainWindow refactoring:

1. Run `python -m apps.native_mac.main` - application launches
2. Verify 4 tabs appear: Race Data, Optimization, Lineups, Settings
3. Click each tab - verify window title updates
4. Verify Race Data tab shows sample driver table
5. Click column headers - verify sorting works
6. Move and resize window, quit, relaunch - verify geometry restored
7. Check imports are clean (no circular dependencies)

## Success Criteria

- [ ] MainWindow moved to gui/main_window.py package
- [ ] Tabbed interface with 4 tabs displays correctly
- [ ] Race Data tab shows driver table with sample data
- [ ] Table sorting works via column header clicks
- [ ] Window geometry persists across app launches
- [ ] main.py properly imports from gui package
- [ ] No circular import errors

## Output

After completion, create `.planning/phases/06-foundation-gui-local-optimization/06-04-SUMMARY.md`
