---
phase: 06-foundation-gui-local-optimization
plan: 09
type: execute
wave: 4
depends_on: ["06-01", "06-04"]
files_modified:
  - apps/native_mac/gui/widgets/about_dialog.py
  - apps/native_mac/gui/main_window.py
  - apps/native_mac/dock_handler.py
  - apps/native_mac/notification_manager.py
autonomous: true

must_haves:
  truths:
    - "User can open About window from app menu showing version, license, and credits"
    - "Application has proper dock icon that bounces on optimization completion"
    - "Dock menu shows recent races and quick actions"
    - "macOS notification appears on optimization completion with 'View' button"
    - "About window follows macOS standard layout (app icon, version, copyright)"
  artifacts:
    - path: "apps/native_mac/gui/widgets/about_dialog.py"
      provides: "AboutDialog following macOS Human Interface Guidelines"
      contains: "class AboutDialog"
    - path: "apps/native_mac/dock_handler.py"
      provides: "DockIconHandler for bounce and dock menu"
      contains: "requestUserAttention"
    - path: "apps/native_mac/notification_manager.py"
      provides: "NotificationManager for macOS native notifications"
      contains: "NSUserNotificationCenter"
  key_links:
    - from: "apps/native_mac/gui/main_window.py"
      to: "apps/native_mac/gui/widgets/about_dialog.py"
      via: "About menu action"
      pattern: "from.*widgets.about_dialog import AboutDialog"
    - from: "apps/native_mac/optimization/progress_worker.py"
      to: "apps/native_mac/dock_handler.py"
      via: "Dock bounce on completion"
      pattern: "from.*dock_handler import DockIconHandler"
    - from: "apps/native_mac/optimization/progress_worker.py"
      to: "apps/native_mac/notification_manager.py"
      via: "Notification on completion"
      pattern: "from.*notification_manager import NotificationManager"
---

## Objective

Create About window, dock icon integration, and macOS notifications to complete the native application experience.

**Purpose:** Native macOS apps require standard integration points: an About window accessible from the app menu, dock icon feedback during long operations, and user notifications for completed tasks. These are expected behaviors for professional Mac apps.

**Output:** About dialog, dock bounce on completion, dock menu with recent items, and native macOS notifications.

## Context

@/Users/zax/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zax/.claude/get-shit-done/templates/summary.md

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-foundation-gui-local-optimization/06-RESEARCH.md
@.planning/phases/06-foundation-gui-local-optimization/06-06-SUMMARY.md

## Tasks

<task type="auto">
  <name>Create AboutDialog following macOS HIG</name>
  <files>apps/native_mac/gui/widgets/about_dialog.py, apps/native_mac/gui/main_window.py</files>
  <action>
Create AboutDialog following macOS Human Interface Guidelines:

1. Create `about_dialog.py` with AboutDialog class (subclass QDialog):

2. Dialog layout (standard macOS About window):
   - App icon: 128x128 QLabel with pixmap
   - App name: "NASCAR DFS Optimizer" (large bold text)
   - Version: "Version 1.0.0" (read from version file)
   - Copyright: "Copyright 2025. All rights reserved."
   - Credits button: Opens credits dialog
   - License button: Opens license dialog

3. Dialog properties:
   - setWindowTitle("") - About windows have no title bar text
   - setFixedSize(400, 300) - standard About window size
   - Non-resizable
   - Centered on parent window

4. Implement credits dialog (sub-dialog):
   - QTextBrowser with developer credits
   - Acknowledgments for open source libraries (PySide6, JAX, pandas)
   - Scrollable text area

5. Implement license dialog (sub-dialog):
   - QTextBrowser with license text
   - MIT License or proprietary license text

6. Update main_window.py:
   - Add about_action to app menu (already created in 06-01)
   - Connect triggered signal to about_dialog.show()
   - Import AboutDialog

7. Version management:
   - Create `version.py` with VERSION = "1.0.0"
   - AboutDialog reads version from this file
   - Used in window title and about dialog

Follow research pattern from 06-RESEARCH.md > macOS About Window.
  </action>
  <verify>
AboutDialog subclasses QDialog
Standard macOS About window layout (icon, name, version, copyright)
No title bar text (setWindowTitle(""))
Credits and License buttons open sub-dialogs
Connected to app menu About action
Version read from version.py
  </verify>
  <done>
AboutDialog created following macOS HIG
Credits and License dialogs functional
Connected to standard About menu
Version management in place
  </done>
</task>

<task type="auto">
  <name>Implement DockIconHandler for bounce and dock menu</name>
  <files>apps/native_mac/dock_handler.py, apps/native_mac/gui/main_window.py</files>
  <action>
Create DockIconHandler for dock icon integration:

1. Create `dock_handler.py` with DockIconHandler class:

2. Dock bounce functionality:
```python
class DockIconHandler(QObject):
    """Handle dock icon interactions and notifications."""
    
    def __init__(self, app: QApplication):
        super().__init__()
        self.app = app
    
    def bounce(self, critical: bool = False):
        """Request user attention via dock bounce.
        
        Args:
            critical: If True, dock icon bounces until app is activated.
                      If False, single bounce notification.
        """
        # Use NSApp via PyObjC for native dock bounce
        from PyObjCTools import AppHelper
        import AppKit
        
        ns_app = AppKit.NSApp()
        if critical:
            ns_app.requestUserAttention_(AppKit.NSCriticalRequest)
        else:
            ns_app.requestUserAttention_(AppKit.NSInformationalRequest)
```

3. Dock menu with recent races:
```python
def create_dock_menu(self, recent_races: list[dict]):
    """Create dock menu with recent races and actions."""
    menu = QMenu()
    
    # Recent races section
    if recent_races:
        menu.addSection("Recent Races")
        for race in recent_races[:5]:
            action = menu.addAction(race['track_name'])
            action.triggered.connect(
                lambda checked, r=race: self.race_selected.emit(r['id'])
            )
        menu.addSeparator()
    
    # Quick actions
    menu.addAction("New Race...", self.new_race_triggered.emit)
    menu.addAction("Generate Lineups", self.generate_lineups_triggered.emit)
    menu.addSeparator()
    menu.addAction("Preferences...", self.preferences_triggered.emit)
    
    self.app.setDockMenu(menu)
```

4. Signals for menu actions:
```python
race_selected = Signal(int)  # race_id
new_race_triggered = Signal()
generate_lineups_triggered = Signal()
preferences_triggered = Signal()
```

5. Update main.py:
   - Create DockIconHandler instance
   - Connect signals to MainWindow methods
   - Update dock menu when races are loaded

6. Integration with optimization:
   - Call dock_handler.bounce(critical=True) when optimization completes
   - Pass recent_races list to update dock menu

Follow research pattern from 06-RESEARCH.md > Dock Icon Integration.
  </action>
  <verify>
DockIconHandler class created
bounce() method calls NSApp requestUserAttention
create_dock_menu builds QMenu with recent races
Signals defined for menu actions
Dock menu shows recent races and quick actions
Bounce triggered on optimization completion
  </verify>
  <done>
DockIconHandler created with bounce functionality
Dock menu with recent races working
Signals connected to MainWindow actions
Bounce animation on optimization completion
  </done>
</task>

<task type="auto">
  <name>Implement NotificationManager for macOS native notifications</name>
  <files>apps/native_mac/notification_manager.py, apps/native_mac/optimization/progress_worker.py</files>
  <action>
Create NotificationManager for macOS native notifications:

1. Create `notification_manager.py` with NotificationManager class:

2. Native notification implementation using PyObjC:
```python
class NotificationManager(QObject):
    """Send native macOS notifications."""
    
    notification_clicked = Signal(str)  # action identifier
    
    def __init__(self):
        super().__init__()
        self._setup_notification_center()
    
    def _setup_notification_center(self):
        """Initialize NSUserNotificationCenter."""
        try:
            from Foundation import NSUserNotificationCenter
            from Foundation import NSUserNotification
            
            self.notification_center = NSUserNotificationCenter.defaultUserNotificationCenter()
            self.notification_center.setDelegate_(self)
            self.NSUserNotification = NSUserNotification
        except ImportError:
            self.notification_center = None
    
    def send_notification(
        self,
        title: str,
        subtitle: str = "",
        informative_text: str = "",
        action_button: str = None,
        identifier: str = None
    ):
        """Send a native macOS notification."""
        if not self.notification_center:
            return
        
        notification = self.NSUserNotification.alloc().init()
        notification.setTitle_(title)
        notification.setSubtitle_(subtitle)
        notification.setInformativeText_(informative_text)
        
        if action_button:
            notification.setActionButtonTitle_(action_button)
            notification.setIdentifier_(identifier or "default")
        
        self.notification_center.deliverNotification_(notification)
```

3. Delegate implementation for click handling:
```python
def userNotificationCenter_didActivateNotification_(self, center, notification):
    """Handle notification click."""
    identifier = notification.identifier()
    self.notification_clicked.emit(identifier)
```

4. Notification for optimization completion:
```python
def notify_optimization_complete(self, num_lineups: int):
    """Send notification when optimization finishes."""
    self.send_notification(
        title="Optimization Complete",
        subtitle=f"Generated {num_lineups} lineups",
        informative_text="Click to view your optimized lineups.",
        action_button="View Lineups",
        identifier="view_lineups"
    )
```

5. Integration with OptimizationWorker:
   - Import NotificationManager in progress_worker.py
   - Call notify_optimization_complete() in finished handler
   - Connect notification_clicked to switch to Lineups tab

6. Notification permissions:
   - Add NSUserNotificationAlertStyle to Info.plist
   - Request notification permission on first use

7. Fallback for sandbox issues:
   - If NSUserNotification unavailable, use QSystemTrayIcon.showMessage()
   - Check if running in sandbox and adapt accordingly

Follow research pattern from 06-RESEARCH.md > macOS Notification Center.
  </action>
  <verify>
NotificationManager class created
NSUserNotificationCenter integration
send_notification creates native macOS notifications
Delegate handles notification clicks
notify_optimization_complete sends completion notification
Action button "View Lineups" triggers tab switch
Fallback to QSystemTrayIcon if needed
  </verify>
  <done>
NotificationManager created with native notifications
Optimization completion notification sent
Action button switches to Lineups tab
Click handling working
Permission handling in place
  </done>
</task>

## Verification

After completing all tasks, verify system integration:

1. Test About window:
   - Click app menu → About NASCAR DFS Optimizer
   - Verify standard macOS About window layout
   - Check Credits and License buttons work

2. Test dock bounce:
   - Run optimization
   - Switch to another app while optimization runs
   - Verify dock icon bounces when optimization completes

3. Test dock menu:
   - Right-click dock icon
   - Verify recent races list appears
   - Click a recent race - verify it loads

4. Test notifications:
   - Run optimization
   - Wait for completion
   - Verify notification appears
   - Click "View Lineups" button - verify app switches to Lineups tab

5. Check notification settings:
   - System Settings → Notifications
   - Verify NASCAR DFS Optimizer appears in list

## Success Criteria

- [ ] About window accessible from app menu
- [ ] About window follows macOS HIG (icon, version, copyright)
- [ ] Credits and License dialogs accessible
- [ ] Dock icon bounces on optimization completion
- [ ] Dock menu shows recent races (up to 5)
- [ ] Dock menu has quick actions (New Race, Generate Lineups)
- [ ] macOS notification appears on optimization completion
- [ ] Notification has "View Lineups" action button
- [ ] Clicking action button switches to Lineups tab

## Output

After completion, create `.planning/phases/06-foundation-gui-local-optimization/06-09-SUMMARY.md`
